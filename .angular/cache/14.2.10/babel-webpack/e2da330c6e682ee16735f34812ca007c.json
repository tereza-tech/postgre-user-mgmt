{"ast":null,"code":"import _asyncToGenerator from \"/home/runner/Usrmgmt/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../supabase.service\";\nimport * as i2 from \"@angular/forms\";\nimport * as i3 from \"../avatar/avatar.component\";\nexport class AccountComponent {\n  constructor(supabase, formBuilder) {\n    this.supabase = supabase;\n    this.formBuilder = formBuilder;\n    this.loading = false;\n    this.updateProfileForm = this.formBuilder.group({\n      username: '',\n      website: '',\n      avatar_url: ''\n    });\n  }\n\n  ngOnInit() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      yield _this.getProfile();\n      const {\n        username,\n        website,\n        avatar_url\n      } = _this.profile;\n\n      _this.updateProfileForm.patchValue({\n        username,\n        website,\n        avatar_url\n      });\n    })();\n  }\n\n  get avatarUrl() {\n    return this.updateProfileForm.value.avatar_url;\n  }\n\n  getProfile() {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      try {\n        _this2.loading = true;\n        const {\n          user\n        } = _this2.session;\n        let {\n          data: profile,\n          error,\n          status\n        } = yield _this2.supabase.profile(user);\n\n        if (error && status !== 406) {\n          throw error;\n        }\n\n        if (profile) {\n          _this2.profile = profile;\n        }\n      } catch (error) {\n        if (error instanceof Error) {\n          alert(error.message);\n        }\n      } finally {\n        _this2.loading = false;\n      }\n    })();\n  }\n\n  updateAvatar(event) {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      _this3.updateProfileForm.patchValue({\n        avatar_url: event\n      });\n\n      yield _this3.updateProfile();\n    })();\n  }\n\n  updateProfile() {\n    var _this4 = this;\n\n    return _asyncToGenerator(function* () {\n      try {\n        _this4.loading = true;\n        const {\n          user\n        } = _this4.session;\n        const username = _this4.updateProfileForm.value.username;\n        const website = _this4.updateProfileForm.value.website;\n        const avatar_url = _this4.updateProfileForm.value.avatar_url;\n        const {\n          error\n        } = yield _this4.supabase.updateProfile({\n          id: user.id,\n          username,\n          website,\n          avatar_url\n        });\n        if (error) throw error;\n      } catch (error) {\n        if (error instanceof Error) {\n          alert(error.message);\n        }\n      } finally {\n        _this4.loading = false;\n      }\n    })();\n  }\n\n  signOut() {\n    var _this5 = this;\n\n    return _asyncToGenerator(function* () {\n      yield _this5.supabase.signOut();\n    })();\n  }\n\n}\n\nAccountComponent.ɵfac = function AccountComponent_Factory(t) {\n  return new (t || AccountComponent)(i0.ɵɵdirectiveInject(i1.SupabaseService), i0.ɵɵdirectiveInject(i2.FormBuilder));\n};\n\nAccountComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: AccountComponent,\n  selectors: [[\"app-account\"]],\n  inputs: {\n    session: \"session\"\n  },\n  decls: 20,\n  vars: 5,\n  consts: [[1, \"form-widget\", 3, \"formGroup\", \"ngSubmit\"], [3, \"avatarUrl\", \"upload\"], [\"for\", \"email\"], [\"id\", \"email\", \"type\", \"text\", \"disabled\", \"\", 3, \"value\"], [\"for\", \"username\"], [\"formControlName\", \"username\", \"id\", \"username\", \"type\", \"text\"], [\"for\", \"website\"], [\"formControlName\", \"website\", \"id\", \"website\", \"type\", \"url\"], [\"type\", \"submit\", 1, \"button\", \"primary\", \"block\", 3, \"disabled\"], [1, \"button\", \"block\", 3, \"click\"]],\n  template: function AccountComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"form\", 0);\n      i0.ɵɵlistener(\"ngSubmit\", function AccountComponent_Template_form_ngSubmit_0_listener() {\n        return ctx.updateProfile();\n      });\n      i0.ɵɵelementStart(1, \"app-avatar\", 1);\n      i0.ɵɵlistener(\"upload\", function AccountComponent_Template_app_avatar_upload_1_listener($event) {\n        return ctx.updateAvatar($event);\n      });\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(2, \"div\")(3, \"label\", 2);\n      i0.ɵɵtext(4, \"Email\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(5, \"input\", 3);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(6, \"div\")(7, \"label\", 4);\n      i0.ɵɵtext(8, \"Name\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(9, \"input\", 5);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(10, \"div\")(11, \"label\", 6);\n      i0.ɵɵtext(12, \"Website\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(13, \"input\", 7);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(14, \"div\")(15, \"button\", 8);\n      i0.ɵɵtext(16);\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(17, \"div\")(18, \"button\", 9);\n      i0.ɵɵlistener(\"click\", function AccountComponent_Template_button_click_18_listener() {\n        return ctx.signOut();\n      });\n      i0.ɵɵtext(19, \"Sign Out\");\n      i0.ɵɵelementEnd()()();\n    }\n\n    if (rf & 2) {\n      i0.ɵɵproperty(\"formGroup\", ctx.updateProfileForm);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"avatarUrl\", ctx.avatarUrl);\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"value\", ctx.session.user.email);\n      i0.ɵɵadvance(10);\n      i0.ɵɵproperty(\"disabled\", ctx.loading);\n      i0.ɵɵadvance(1);\n      i0.ɵɵtextInterpolate1(\" \", ctx.loading ? \"Loading ...\" : \"Update\", \" \");\n    }\n  },\n  dependencies: [i2.ɵNgNoValidate, i2.DefaultValueAccessor, i2.NgControlStatus, i2.NgControlStatusGroup, i2.FormGroupDirective, i2.FormControlName, i3.AvatarComponent],\n  styles: [\"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJhY2NvdW50LmNvbXBvbmVudC5jc3MifQ== */\"]\n});","map":{"version":3,"mappings":"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","names":["AccountComponent","constructor","supabase","formBuilder","group","username","website","avatar_url","ngOnInit","getProfile","profile","updateProfileForm","patchValue","avatarUrl","value","loading","user","session","data","error","status","Error","alert","message","updateAvatar","event","updateProfile","id","signOut","i0","selectors","inputs","decls","vars","consts","template","ctx"],"sourceRoot":"","sources":["/home/runner/Usrmgmt/src/app/account/account.component.ts","/home/runner/Usrmgmt/src/app/account/account.component.html"],"sourcesContent":["import { Component, Input, OnInit } from '@angular/core';\nimport { FormBuilder } from '@angular/forms';\nimport { AuthSession } from '@supabase/supabase-js';\nimport { Profile, SupabaseService } from '../supabase.service';\n\n@Component({\n  selector: 'app-account',\n  templateUrl: './account.component.html',\n  styleUrls: ['./account.component.css'],\n})\nexport class AccountComponent implements OnInit {\n  loading = false;\n  profile!: Profile;\n\n  @Input()\n  session!: AuthSession;\n\n  updateProfileForm = this.formBuilder.group({\n    username: '',\n    website: '',\n    avatar_url: '',\n  });\n\n  constructor(\n    private readonly supabase: SupabaseService,\n    private formBuilder: FormBuilder\n  ) {}\n\n  async ngOnInit(): Promise<void> {\n    await this.getProfile();\n\n    const { username, website, avatar_url } = this.profile;\n    this.updateProfileForm.patchValue({\n      username,\n      website,\n      avatar_url,\n    });\n  }\n\n  get avatarUrl() {\n    return this.updateProfileForm.value.avatar_url as string;\n  }\n\n  async getProfile() {\n    try {\n      this.loading = true;\n      const { user } = this.session;\n      let { data: profile, error, status } = await this.supabase.profile(user);\n\n      if (error && status !== 406) {\n        throw error;\n      }\n\n      if (profile) {\n        this.profile = profile;\n      }\n    } catch (error) {\n      if (error instanceof Error) {\n        alert(error.message);\n      }\n    } finally {\n      this.loading = false;\n    }\n  }\n\n  async updateAvatar(event: string): Promise<void> {\n    this.updateProfileForm.patchValue({\n      avatar_url: event,\n    });\n    await this.updateProfile();\n  }\n\n  async updateProfile(): Promise<void> {\n    try {\n      this.loading = true;\n      const { user } = this.session;\n\n      const username = this.updateProfileForm.value.username as string;\n      const website = this.updateProfileForm.value.website as string;\n      const avatar_url = this.updateProfileForm.value.avatar_url as string;\n\n      const { error } = await this.supabase.updateProfile({\n        id: user.id,\n        username,\n        website,\n        avatar_url,\n      });\n      if (error) throw error;\n    } catch (error) {\n      if (error instanceof Error) {\n        alert(error.message);\n      }\n    } finally {\n      this.loading = false;\n    }\n  }\n\n  async signOut() {\n    await this.supabase.signOut();\n  }\n}\n","<form [formGroup]=\"updateProfileForm\" (ngSubmit)=\"updateProfile()\" class=\"form-widget\">\n  <app-avatar\n    [avatarUrl]=\"this.avatarUrl\"\n    (upload)=\"updateAvatar($event)\">\n  </app-avatar>\n  <div>\n    <label for=\"email\">Email</label>\n    <input id=\"email\" type=\"text\" [value]=\"session.user.email\" disabled />\n  </div>\n  <div>\n    <label for=\"username\">Name</label>\n    <input\n      formControlName=\"username\"\n      id=\"username\"\n      type=\"text\"\n    />\n  </div>\n  <div>\n    <label for=\"website\">Website</label>\n    <input\n      formControlName=\"website\"\n      id=\"website\"\n      type=\"url\"\n    />\n  </div>\n\n  <div>\n    <button\n      type=\"submit\"\n      class=\"button primary block\"\n      [disabled]=\"loading\"\n    >\n      {{ loading ? 'Loading ...' : 'Update' }}\n    </button>\n  </div>\n\n  <div>\n    <button class=\"button block\" (click)=\"signOut()\">Sign Out</button>\n  </div>\n</form>\n"]},"metadata":{},"sourceType":"module"}